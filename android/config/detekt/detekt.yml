# detekt configuration for Still Moment Android
# https://detekt.dev/docs/rules/all

build:
  maxIssues: 0
  excludeCorrectable: false

config:
  validation: true
  warningsAsErrors: true

processors:
  active: true

console-reports:
  active: true

output-reports:
  active: true

complexity:
  active: true
  CyclomaticComplexMethod:
    active: true
    threshold: 15
  LongMethod:
    active: true
    threshold: 60
  LongParameterList:
    active: true
    functionThreshold: 8
    constructorThreshold: 10
    ignoreDefaultParameters: true
    ignoreDataClasses: true
    ignoreAnnotatedParameter: ["Composable"]
  NestedBlockDepth:
    active: true
    threshold: 4
  TooManyFunctions:
    active: true
    thresholdInFiles: 15
    thresholdInClasses: 15
    thresholdInInterfaces: 10
    thresholdInObjects: 15
    thresholdInEnums: 5
    ignoreDeprecated: true
    ignorePrivate: true
    ignoreOverridden: true

coroutines:
  active: true
  GlobalCoroutineUsage:
    active: true
  SuspendFunWithFlowReturnType:
    active: true

empty-blocks:
  active: true
  EmptyCatchBlock:
    active: true
    allowedExceptionNameRegex: "_|(ignore|expected).*"
  EmptyFunctionBlock:
    active: true
    ignoreOverridden: true

exceptions:
  active: true
  SwallowedException:
    active: true
    ignoredExceptionTypes:
      - "InterruptedException"
      - "MalformedURLException"
      - "NumberFormatException"
      - "ParseException"
  TooGenericExceptionCaught:
    active: true
    exceptionNames:
      - "Error"
      - "Exception"
      - "RuntimeException"
      - "Throwable"
    allowedExceptionNameRegex: "_|(ignore|expected).*"

naming:
  active: true
  # Disabled: Compose uses PascalCase for @Composable functions
  # Note: detekt-compose ComposableNaming Rule handles Compose-specific naming
  FunctionNaming:
    active: false
  # ktlint handles this via .editorconfig (ktlint_standard_property-naming)
  # we use _state pattern for MutableStateFlow backing
  VariableNaming:
    active: true
    excludes: ["**/test/**", "**/androidTest/**"]
    variablePattern: "[a-z][A-Za-z0-9]*|_[a-zA-Z][A-Za-z0-9]*"

performance:
  active: true
  SpreadOperator:
    active: true
    excludes: ["**/test/**", "**/androidTest/**"]

potential-bugs:
  active: true
  CastToNullableType:
    active: true
  EqualsAlwaysReturnsTrueOrFalse:
    active: true
  ExitOutsideMain:
    active: true
  HasPlatformType:
    active: true
  IgnoredReturnValue:
    active: true
    restrictToConfig: true
  ImplicitUnitReturnType:
    active: true
    allowExplicitReturnType: true
  NullableToStringCall:
    active: true
  UnreachableCatchBlock:
    active: true
  UnsafeCallOnNullableType:
    active: true

style:
  active: true
  DestructuringDeclarationWithTooManyEntries:
    active: true
    maxDestructuringEntries: 4
  # Compose @Preview functions are detected as unused but are used by Android Studio
  UnusedPrivateMember:
    active: true
    allowedNames: "(_|ignored|expected|serialVersionUID|.*Preview)"
  ForbiddenComment:
    active: true
    comments:
      - reason: "FIXME should be resolved before merging"
        value: "FIXME:"
      - reason: "STOPSHIP should be resolved before release"
        value: "STOPSHIP:"
  MagicNumber:
    active: true
    excludes: ["**/test/**", "**/androidTest/**", "**/presentation/ui/**"]
    ignoreNumbers:
      - "-1"
      - "0"
      - "1"
      - "2"
      - "10"
      - "60"       # seconds/minutes
      - "100"
      - "1000"
      - "3600"     # seconds in hour
      - "60000"    # ms in minute
      - "3600000"  # ms in hour
    ignoreHashCodeFunction: true
    ignorePropertyDeclaration: true
    ignoreLocalVariableDeclaration: false
    ignoreConstantDeclaration: true
    ignoreCompanionObjectPropertyDeclaration: true
    ignoreAnnotation: true
    ignoreNamedArgument: true
    ignoreEnums: true
    ignoreRanges: true
    ignoreExtensionFunctions: true
  MaxLineLength:
    active: true
    maxLineLength: 120
    excludePackageStatements: true
    excludeImportStatements: true
    excludeCommentStatements: true
    excludeRawStrings: true
  ReturnCount:
    active: true
    max: 4
    excludedFunctions:
      - "equals"
    excludeLabeled: true
    excludeReturnFromLambda: true
    excludeGuardClauses: true
  ThrowsCount:
    active: true
    max: 3
    excludeGuardClauses: true
  UseCheckOrError:
    active: true
  UseRequire:
    active: true
  WildcardImport:
    active: false  # ktlint handles this

# ============================================================================
# Compose Rules (io.nlopez.compose.rules:detekt)
# https://mrmans0n.github.io/compose-rules/
# ============================================================================
Compose:
  # --- Naming Rules ---
  ComposableNaming:
    active: true
    # Erlaubt standard PascalCase Composables
  ComposableAnnotationNaming:
    active: true
  CompositionLocalNaming:
    active: true
  ModifierNaming:
    active: true
  ParameterNaming:
    active: true
    treatAsLambda: []

  # --- Parameter & State Rules ---
  ComposableParamOrder:
    active: true
  MutableParams:
    active: true
  MutableStateParam:
    active: true
  MutableStateAutoboxing:
    active: true
  DefaultsVisibility:
    active: true

  # --- Modifier Rules ---
  ModifierMissing:
    active: true
    # checkModifiersForVisibility: only_public
  ModifierWithoutDefault:
    active: true
  ModifierClickableOrder:
    active: true
  ModifierComposed:
    active: true
  ModifierReused:
    active: true
  ModifierNotUsedAtRoot:
    active: true

  # --- Content & Emission Rules ---
  ContentEmitterReturningValues:
    active: true
  ContentTrailingLambda:
    active: true
  MultipleEmitters:
    active: true
    # contentEmittersDenylist für Custom-Emitter falls nötig

  # --- Remember & State ---
  RememberMissing:
    active: true
  RememberContentMissing:
    active: true
  LambdaParameterInRestartableEffect:
    active: true
  UnstableCollections:
    active: true

  # --- ViewModel Rules ---
  ViewModelForwarding:
    active: true
  ViewModelInjection:
    active: true

  # --- Preview Rules ---
  PreviewAnnotationNaming:
    active: true
  PreviewPublic:
    active: true
    # Previews sollten private sein

  # --- CompositionLocal Rules ---
  CompositionLocalAllowlist:
    active: true
    allowedCompositionLocals:
      - "LocalIsDarkTheme"

  # --- Material Rules ---
  Material2:
    active: false  # Wir nutzen Material3
