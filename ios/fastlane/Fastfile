# Fastfile - Fastlane Configuration
# https://docs.fastlane.tools

default_platform(:ios)

platform :ios do
  desc "Generate localized screenshots for App Store and website"
  lane :screenshots do
    # Capture screenshots using Snapshot
    capture_screenshots(
      testplan: nil,
      only_testing: ["StillMomentUITests/ScreenshotTests"]
    )

    # Post-process: copy and rename to docs/images/screenshots/
    sh("cd .. && ./scripts/process-screenshots.sh")

    UI.success("Screenshots generated successfully!")
    UI.message("Output: ../docs/images/screenshots/")
  end

  desc "Generate single screenshot in all languages (keeps existing screenshots)"
  lane :screenshot_single do |options|
    test_name = options[:test] || ENV["TEST"]

    UI.user_error!("TEST parameter required. Usage: bundle exec fastlane screenshot_single test:testScreenshot05_SettingsView") unless test_name

    capture_screenshots(
      only_testing: ["StillMomentUITests/ScreenshotTests/#{test_name}"],
      clear_previous_screenshots: false
    )

    sh("cd .. && ./scripts/process-screenshots.sh")

    UI.success("Screenshot '#{test_name}' generated in EN + DE!")
  end

  desc "Validate screenshot setup (quick check)"
  lane :screenshot_validate do
    # Just build the scheme to verify everything compiles
    build_app(
      scheme: "StillMoment-Screenshots",
      skip_archive: true,
      skip_codesigning: true,
      build_path: "./build",
      derived_data_path: "./build/DerivedData"
    )
    UI.success("Screenshot setup validated!")
  end
end
